---
title: 601.Human Traffic of Stadium体育馆的人流量
date: 2020-01-20 14:10:12
categories: 2020年1月
tags: [LeetCode,Database]

---

查询连续递增的序列

<!-- more -->

# 思路:

在表 stadium 中查询人流量超过 100 的记录，将查询结果与其自身的临时表连接，再使用 WHERE 子句获得满足条件的记录。

第一步：查询人流量超过 100 的记录，然后将结果与其自身的临时表连接。
MySQL

    select distinct t1.*
    from stadium t1, stadium t2, stadium t3
    where t1.people >= 100 and t2.people >= 100 and t3.people >= 100
    ;

共有 6 天人流量超过 100 人，笛卡尔积 后有 216（666） 条记录。

前 3 列来自表 t1，中间 3 列来自表 t2，最后 3 列来自表 t3。

表 t1，t2 和 t3 相同，需要考虑添加哪些条件能够得到想要的结果。以 t1 为例，它有可能是高峰期的第 1 天，第 2 天，或第 3 天。

t1 是高峰期第 1 天：

    (t1.id - t2.id = -1 and t1.id - t3.id = -2 and t2.id - t3.id =-1) -- t1, t2, t3

t1 是高峰期第 2 天：

    (t2.id - t1.id = -1 and t2.id - t3.id = -2 and t1.id - t3.id =-1) -- t2, t1, t3

t1 是高峰期第 3 天：

    (t3.id - t2.id = -1 and t2.id - t1.id =-1 and t3.id - t1.id = -2) -- t3, t2, t1

因此：

    select t1.*
    from stadium t1, stadium t2, stadium t3
    where t1.people >= 100 and t2.people >= 100 and t3.people >= 100
    and
    (
      (t1.id - t2.id = -1 and t1.id - t3.id = -2 and t2.id - t3.id =-1)  -- t1, t2, t3
      or
      (t2.id - t1.id = -1 and t2.id - t3.id = -2 and t1.id - t3.id =-1) -- t2, t1, t3
      or
      (t3.id - t2.id = -1 and t2.id - t1.id =-1 and t3.id - t1.id = -2) -- t3, t2, t1
    )
    ;

    | id | date       | people |
    |----|------------|--------|
    | 7  | 2017-01-07 | 199    |
    | 6  | 2017-01-06 | 1455   |
    | 8  | 2017-01-08 | 188    |
    | 7  | 2017-01-07 | 199    |
    | 5  | 2017-01-05 | 145    |
    | 6  | 2017-01-06 | 1455   |

可以看到查询结果中存在重复的记录，再使用 DISTINCT 去重。

    select distinct t1.*
    from stadium t1, stadium t2, stadium t3
    where t1.people >= 100 and t2.people >= 100 and t3.people >= 100
    and
    (
    	  (t1.id - t2.id = -1 and t1.id - t3.id = -2 and t2.id - t3.id =-1)  -- t1, t2, t3
        or
        (t2.id - t1.id = -1 and t2.id - t3.id = -2 and t1.id - t3.id =-1) -- t2, t1, t3
        or
        (t3.id - t2.id = -1 and t2.id - t1.id =-1 and t3.id - t1.id = -2) -- t3, t2, t1
    )
    order by t1.id
    ;

此题官方题解貌似把t1,t2,t3的id前后顺序搞反了，不过也不影响执行结果。
# 参考资料：
【1】https://leetcode.com/problems/human-traffic-of-stadium/
